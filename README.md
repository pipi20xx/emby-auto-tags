# Emby 自动标签工具

这是一个用于 Emby 的辅助工具，它通过接收 Emby 的 Webhook 通知，根据用户自定义的规则，自动为电影和剧集添加标签。

## 更新日志

<details>
<summary>点击展开/折叠</summary>

- **v1.0.7 (2025-08-25)**
  - **新增功能**: 标签规则支持“严格匹配所有条件”选项。
    - 在规则编辑界面新增“严格匹配所有条件”复选框。
    - 勾选此选项后，规则中的国家/地区和类型条件将变为严格匹配模式，即传入的媒体信息必须包含规则中定义的所有国家/地区和类型 ID 才能匹配成功。
    - 未勾选时，保持原有模糊匹配逻辑（只要命中一个就算匹配）。
- **v1.0.8 (2025-08-25)**
  - **新增功能**: 标签规则支持筛选年份。
  - **优化**: 严格规则的判断逻辑修改为完全相等匹配。
- **v1.0.6 (2025-08-25)**
  - **前端**: 对管理面板进行了全面的 UI/UX 美化。
    - **样式现代化**: 更新了整体 CSS 样式，包括颜色、字体、边距和阴影，使界面更具现代感。
    - **通知系统**: 引入 `Toastify-js`，将所有操作结果（如复制成功、保存配置、任务状态等）统一为右上角弹出的 Toast 通知，取代了页面内的文字提示。
    - **美化弹窗**: 引入 `SweetAlert2`，将所有原生 `confirm` 确认框替换为更美观、更友好的对话框。
    - **自适应布局**: 优化了“标签规则管理”弹窗，使其宽度能根据浏览器视口自适应，并使用 CSS Grid 布局使内部的复选框列数能够动态调整，极大地改善了在不同分辨率屏幕上的显示效果和空间利用率。
- **v1.0.5 (2025-08-24)**
  - **优化**: 统一并优化了国家/地区的判断逻辑。
    - **严格限定判断依据**：现在无论是电影还是电视剧，都严格使用 TMDB 数据根目录下的 `origin_country` 字段作为首要判断依据，`original_language` 作为备用。
    - **排除干扰字段**：完全移除了 `production_countries` 和 `production_companies` 作为判断国家/地区的逻辑，解决了因此导致的国家识别不准确问题。
  - **改进**: 优化了测试预览界面的显示。
    - 在预览结果中，地区将优先显示中文名称，使结果更直观、更易于理解。
- **v1.0.4 (2025-08-24)**
  - **新增功能**: 标签规则支持设置作用于电影、剧集或全部。
    - 在规则编辑界面新增“作用于”选项，允许用户指定规则仅应用于电影、剧集或所有媒体类型。
    - 后端逻辑已更新，根据此设置过滤规则。
- **v1.0.3 (2025-08-24)**
  - **新增功能**: TMDB 请求限流功能。
    - 增加了对 TMDB API 请求的限流，默认每秒1次。
    - 限流周期可在配置页面设置，支持小数（如0.3秒、0.5秒），设置为0表示不限制。
  - **依赖更新**: 添加了 `ratelimit` 和 `backoff` 库。
- **v1.0.2 (2025-08-24)**
  - **新增功能**: 添加了“一键为所有媒体打标签”功能。
    - 在 Web 管理面板中新增了“一键为所有媒体打标签”区域，允许用户选择写入模式（合并/覆盖）并触发对所有电影和剧集进行打标签操作。
    - 任务在后台异步执行，前端页面通过轮询API实时显示任务进度（已处理、已更新、失败数量）。
  - **改进**: 优化了后台任务的日志记录，将 `print` 语句替换为 `logging` 模块。
  - **修复**: 修复了 `AttributeError: module 'services.config_service' has no attribute 'get_current_time'` 错误。
    - **v1.0.9 (2025-08-25)**
      - **新增功能**: 添加了“清除 Emby 媒体库中的指定标签”功能。
        - 在 Web 管理面板中新增了“清除 Emby 媒体库中的指定标签”区域，允许用户输入一个或多个标签，并从所有电影和剧集中移除这些标签。
        - 此操作不可撤销，请谨慎使用。
    - **v1.0.1 (2025-08-24)**
      - **新增功能**: 添加了“清除所有 Emby 媒体库标签”功能。
        - 在 Web 管理面板中新增了“清除所有 Emby 媒体库标签”按钮，允许用户一键清除所有电影和剧集的标签。
        - 此操作不可撤销，请谨慎使用。
    - **v1.0.0 (2025-08-24)**
      - 项目初始化。

</details>

## 核心功能

- **Webhook 驱动的自动化**: 通过 Emby Webhook 实时响应媒体库更新。
- **基于规则的标签生成**: 可视化创建和管理标签规则。
- **灵活的标签写入**: 支持合并和覆盖两种模式，并提供预览。
- **全面的 Web 管理面板**: 轻松完成所有配置、规则设定和功能测试。
- **TMDB 集成**: 利用 The Movie Database (TMDB) 的数据来丰富媒体信息。
- **Docker 支持**：易于通过 Docker 和 Docker Compose 进行部署。
- **自定义标签**：通过TMDB返还的信息提取地区和类型来进行自定义标签操作。

## 快速开始

## Docker Compose 示例

```yaml
version: '3.8'

services:
  backend:
    image: pipi20xx/emby-auto-tags:latest
    container_name: emby-auto-tags
    ports:
      - "6005:8000"
    volumes:
      - ./config:/app/config
    restart: always
    network_mode: bridge
```

webhook通知选择类型为JSON
![alt text](img/image.png)

## 🙏 致谢

本项目的设计和功能受到了以下优秀项目的启发，特此感谢：

- **[kuroyukihime0/emby_scripts](https://github.com/kuroyukihime0/emby_scripts)**
---
